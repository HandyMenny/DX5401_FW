Index: linux-4.1.52/drivers/scsi/libsas/sas_expander.c
===================================================================
--- linux-4.1.52.orig/drivers/scsi/libsas/sas_expander.c	2018-05-28 10:26:45.000000000 +0800
+++ linux-4.1.52/drivers/scsi/libsas/sas_expander.c	2021-10-01 15:27:46.147580918 +0800
@@ -47,17 +47,16 @@
 	unsigned long flags;
 
 	spin_lock_irqsave(&task->task_state_lock, flags);
-	if (!(task->task_state_flags & SAS_TASK_STATE_DONE))
+	if (!(task->task_state_flags & SAS_TASK_STATE_DONE)) {
 		task->task_state_flags |= SAS_TASK_STATE_ABORTED;
+		complete(&task->slow_task->completion);
+	}
 	spin_unlock_irqrestore(&task->task_state_lock, flags);
-
-	complete(&task->slow_task->completion);
 }
 
 static void smp_task_done(struct sas_task *task)
 {
-	if (!del_timer(&task->slow_task->timer))
-		return;
+	del_timer(&task->slow_task->timer);
 	complete(&task->slow_task->completion);
 }
 
