Index: miniupnpd-1.6.20110730/upnpreplyparse.c
===================================================================
--- miniupnpd-1.6.20110730.orig/upnpreplyparse.c	2011-02-15 01:55:58.000000000 +0800
+++ miniupnpd-1.6.20110730/upnpreplyparse.c	2021-01-05 14:24:15.475828596 +0800
@@ -59,9 +59,10 @@
                struct NameValueParserData * data)
 {
     struct xmlparser parser;
-    LIST_INIT(&(data->head));
-	data->portListing = NULL;
-	data->portListingLength = 0;
+    memset(data, 0, sizeof(struct NameValueParserData));
+	//LIST_INIT(&(data->head));
+	//data->portListing = NULL;
+	//data->portListingLength = 0;
     /* init xmlparser object */
     parser.xmlstart = buffer;
     parser.xmlsize = bufsize;
Index: miniupnpd-1.6.20110730/upnpsoap.c
===================================================================
--- miniupnpd-1.6.20110730.orig/upnpsoap.c	2021-01-05 14:20:44.090689890 +0800
+++ miniupnpd-1.6.20110730/upnpsoap.c	2021-01-05 14:24:18.731213605 +0800
@@ -1479,6 +1479,13 @@
 	rem_port = GetValueFromNameValueList(&data, "RemotePort");
 	protocol = GetValueFromNameValueList(&data, "Protocol");
 
+	if (!int_port || !rem_port || !protocol)
+	{
+		ClearNameValueList(&data);
+		SoapError(h, 402, "Invalid Args");
+		return;
+	}
+
 	rport = (unsigned short)atoi(rem_port);
 	iport = (unsigned short)atoi(int_port);
 	proto = atoi(protocol);
